<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุงููุณุจุญุฉ</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="ุงููุณุจุญุฉ - ุชุทุจูู ูุณุจุญุฉ ุฅููุชุฑูููุฉ ุจุณูุท ูุณุงุนุฏู ุนูู ุนุฏู ุงูุฃุฐูุงุฑ ูุงูุชุณุงุจูุญ ุจุณูููุฉ. ูุญูุธ ุฃุนูู ุนุฏุฏ ููู ุฐูุฑุ ููุนูู ุจุฏูู ุงูุชุฑูุช ุนูุฏ ุชุซุจูุชู ูุชุทุจูู (PWA) ุนูู ุฌูุงุฒู. ุตุฏูุฉ ุฌุงุฑูุฉ.">
    <link rel="canonical" href="https://yelsabbagh.github.io/AlMisbahah/">

    <!-- Open Graph / Facebook / Social Media Meta Tags -->
    <meta property="og:title" content="ุงููุณุจุญุฉ - ุนุฏุงุฏ ุฃุฐูุงุฑ ุฅููุชุฑููู">
    <meta property="og:description" content="ุชุทุจูู ุจุณูุท ููุฌุงูู ูุนุฏ ุงูุฃุฐูุงุฑ ูุงูุชุณุงุจูุญุ ูุนูู ุจุฏูู ุงูุชุฑูุช ููุญูุธ ุชูุฏูู.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yelsabbagh.github.io/AlMisbahah/">
    <meta property="og:image" content="https://yelsabbagh.github.io/AlMisbahah/icons/icon-512x512.png">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Theme Color for Browsers -->
    <meta name="theme-color" content="#e8e8e8"/>

    <!-- iOS Specific Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ุงููุณุจุญุฉ">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <!-- Favicon for Browser Tab -->
    <link rel="icon" href="icons/icon-192x192.png" type="image/png">

    <style>
        /* --- Basic Reset & Body --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
            direction: rtl;
            background-color: #f4f1ea;
            color: #4a4a4a;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        /* --- Top Share Bar --- */
        #top-share-bar { background-color: #e0e0e0; padding: 8px 15px; text-align: center; width: 100%; box-shadow: 0 1px 3px rgba(0,0,0,0.1); z-index: 900; }
        .top-share-buttons { display: flex; justify-content: center; align-items: center; gap: 15px; }
        .top-share-buttons span { font-size: 0.9em; color: #555; margin-left: 10px; }
        .top-share-buttons a { display: inline-flex; align-items: center; text-decoration: none; transition: transform 0.2s ease, opacity 0.2s ease; }
        .top-share-buttons a:hover { opacity: 0.8; transform: scale(1.05); }
        .top-share-buttons img { width: 28px; height: 28px; vertical-align: middle; }
        #copy-status-top { font-size: 0.8em; color: green; margin-right: 10px; min-height: 1em; min-width: 50px; display: inline-block; text-align: center; }

        /* --- Reminder Area --- */
        #reminder-area { text-align: center; padding: 5px 15px 10px 15px; background-color: #f0f0f0; border-bottom: 1px solid #e0e0e0; }
        #enable-reminders-button { margin: 5px auto; padding: 8px 15px; font-size: 0.9em; cursor: pointer; background-color: #2a6f6f; color: white; border: none; border-radius: 6px; transition: background-color 0.3s ease; }
        #enable-reminders-button:hover { background-color: #1e5252; }
        #enable-reminders-button:disabled { opacity: 0.7; cursor: not-allowed; }
        #reminder-status { font-size: 0.85em; color: #555; min-height: 1em; margin-top: 5px; }

        /* --- Main Container --- */
        .container { width: 95%; max-width: 1280px; margin: 20px auto; flex-grow: 1; display: flex; flex-direction: column; }

        /* --- Counter Area --- */
        #counter-area { background-color: #e8e8e8; padding: 25px 20px; min-height: 75vh; border-radius: 12px; text-align: center; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08); position: relative; border: 1px solid #dcdcdc; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; transition: transform 0.1s ease; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; outline: none; }
        #counter-area:active:not(:has(#reset-button:active)) { transform: scale(0.99); }
        #counter-area:has(#reset-button:active) { transform: none; cursor: default; }
        #reset-button:active { transform: scale(0.98); }
        #selected-dhikr { font-size: 1.8em; color: #2a6f6f; margin-bottom: 15px; min-height: 1.5em; font-weight: bold; width: 90%; pointer-events: none; }
        #counter-display { margin-bottom: 20px; pointer-events: none; display: flex; flex-direction: column; align-items: center; }
        #counter-display .hits { font-size: 4em; font-weight: bold; color: #8b5a2b; display: block; }
        #counter-display .label { font-size: 1.1em; color: #666; }
        .top-score { font-size: 1em; color: #666; margin-top: 10px; } /* Label will be updated by JS */
        #reset-button { position: absolute; top: 15px; left: 15px; padding: 8px 15px; font-size: 0.9em; font-family: inherit; cursor: pointer; background-color: #8b5a2b; color: #f4f1ea; border: none; border-radius: 6px; transition: background-color 0.3s ease, transform 0.1s ease; box-shadow: 0 1px 3px rgba(0,0,0,0.1); z-index: 10; }
        #reset-button:hover { background-color: #a06b3e; }

        /* --- Scroll Down Arrow --- */
        #scroll-down-arrow { display: block; text-align: center; margin-top: 20px; margin-bottom: 30px; font-size: 3em; color: #2a6f6f; cursor: pointer; transition: color 0.3s ease, transform 0.1s ease; line-height: 1; width: 100%; }
        #scroll-down-arrow:hover { color: #1e5252; }
        #scroll-down-arrow:active { transform: translateY(2px); }

        /* --- Dhikr Selection Area --- */
        #dhikr-selection { padding-top: 20px; display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 30px; }
        .dhikr-option { background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 10px; padding: 20px 15px; width: calc(25% - 15px); min-width: 180px; text-align: right; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease; display: flex; flex-direction: column; min-height: 150px; }
        .dhikr-text { font-size: 1.3em; font-weight: 600; color: #2a6f6f; margin-bottom: 10px; flex-grow: 1; }
        .dhikr-evidence { font-size: 0.75em; color: #777; line-height: 1.5; border-top: 1px dashed #eee; padding-top: 10px; margin-top: auto; }
        .dhikr-evidence strong { color: #555; font-weight: normal; display: block; margin-top: 5px; }
        .dhikr-option:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); }
        .dhikr-option.selected { background-color: #2a6f6f; color: #ffffff; border-color: #1e5252; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15); }
        .dhikr-option.selected .dhikr-text { color: #ffffff; }
        .dhikr-option.selected .dhikr-evidence { color: #e0f2f1; border-top-color: #4a8a8a; }
        .dhikr-option.selected .dhikr-evidence strong { color: #c0dfdf; }

        /* --- Footer --- */
        footer { text-align: center; padding: 10px; margin-top: auto; font-size: 0.9em; color: #888; width: 100%; background-color: #e8e8e8; border-top: 1px solid #dcdcdc; min-height: 1em; }

        /* --- Share Popup --- */
        #share-popup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); display: none; justify-content: center; align-items: center; z-index: 999; }
        #share-popup { position: relative; background-color: #ffffff; padding: 35px 25px 25px 25px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2); z-index: 1000; max-width: 90%; width: 450px; text-align: right; border: 1px solid #ddd; }
        #close-popup-button { position: absolute; top: 10px; left: 10px; font-size: 1.8em; font-weight: bold; line-height: 1; color: #aaa; cursor: pointer; background: none; border: none; padding: 0 5px; transition: color 0.2s ease; }
        #close-popup-button:hover { color: #555; }
        #share-popup h3 { color: #2a6f6f; margin-bottom: 15px; font-size: 1.4em; text-align: center; }
        #share-popup p { margin-bottom: 12px; line-height: 1.7; font-size: 0.95em; color: #555; }
        #share-popup p strong { color: #8b5a2b; }
        .popup-section { border-top: 1px dashed #eee; padding-top: 15px; margin-top: 15px; }
        .popup .share-buttons { display: flex; justify-content: center; gap: 20px; margin-top: 10px; flex-wrap: wrap; }
        .popup .share-buttons a { display: inline-block; text-decoration: none; transition: transform 0.2s ease; }
        .popup .share-buttons a:hover { transform: scale(1.1); }
        .popup .share-buttons img { width: 40px; height: 40px; vertical-align: middle; }
        #copy-status-popup { display: block; text-align: center; margin-top: 10px; font-size: 0.9em; color: green; min-height: 1em; min-width: 80px; }

        /* --- Responsive Adjustments --- */
        @media (max-width: 1200px) { .dhikr-option { width: calc(33.333% - 14px); } }
        @media (max-width: 768px) {
             .dhikr-option { width: calc(50% - 10px); }
             #selected-dhikr { font-size: 1.5em; }
             #counter-display .hits { font-size: 3.5em; }
             #scroll-down-arrow { font-size: 2.5em; margin-top: 15px; margin-bottom: 25px; }
             #counter-area { min-height: 70vh; }
             .top-share-buttons span { display: none; }
             #copy-status-top { margin-right: 0; }
        }
        @media (max-width: 480px) {
             .dhikr-option { width: 100%; }
             #reset-button { top: 10px; left: 10px; padding: 6px 10px; font-size: 0.8em; }
             #scroll-down-arrow { font-size: 2em; margin-top: 10px; margin-bottom: 20px; }
             #top-share-bar { padding: 6px 10px; }
             .top-share-buttons img { width: 24px; height: 24px; }
             .top-share-buttons { gap: 10px; }
             #share-popup { width: 90%; padding: 30px 15px 20px 15px; }
             #share-popup h3 { font-size: 1.2em; }
             #share-popup p { font-size: 0.9em; }
             .popup .share-buttons { gap: 15px; }
             .popup .share-buttons img { width: 35px; height: 35px; }
             #reminder-area { padding: 5px 10px 8px 10px; }
             #enable-reminders-button { font-size: 0.8em; padding: 6px 10px; }
             #reminder-status { font-size: 0.8em; }
        }
    </style>
</head>
<body>

    <!-- Permanent Top Share Bar -->
    <div id="top-share-bar">
        <div class="top-share-buttons">
            <a href="#" id="whatsapp-share-top" aria-label="ูุดุงุฑูุฉ ุนุจุฑ ูุงุชุณุงุจ"><img src="icons/whatsapp-icon.png" alt="WhatsApp"></a>
            <a href="#" id="telegram-share-top" aria-label="ูุดุงุฑูุฉ ุนุจุฑ ุชูููุฌุฑุงู"><img src="icons/telegram-icon.png" alt="Telegram"></a>
            <a href="#" id="copy-link-top" aria-label="ูุณุฎ ุงูุฑุงุจุท ูุงูุฑุณุงูุฉ"><img src="icons/copy-link-icon.png" alt="ูุณุฎ ุงูุฑุงุจุท"></a>
        </div>
    </div>

    <div class="container">
        <!-- Counter Area -->
        <div id="counter-area" tabindex="0">
            <button id="reset-button">ุฅุนุงุฏุฉ ุงูุถุจุท</button>
            <div id="selected-dhikr">ุงุฎุชุฑ ุฐูุฑุงู ููุจุฏุก</div>
            <div id="counter-display">
                <span class="hits">0</span>
                <span class="label">ูุฑุงุช</span>
                <div class="top-score">ุฃุนูู ุฑุตูุฏ ุฅุฌูุงูู: 0</div> <!-- Updated Label -->
            </div>
        </div>
        <!-- Scroll Down Arrow -->
        <div id="scroll-down-arrow">โ</div>
        <!-- Dhikr Selection Grid -->
        <div id="dhikr-selection">

            <!-- 1. (Previously Option 1) - Tahlil 100x: Immense comprehensive reward -->
            <div class="dhikr-option" data-dhikr="ูุง ุฅูู ุฅูุง ุงููู ูุญุฏู ูุง ุดุฑูู ููุ ูู ุงูููู ููู ุงูุญูุฏ ููู ุนูู ูู ุดูุก ูุฏูุฑ">
                <span class="dhikr-text">ูุง ุฅูู ุฅูุง ุงููู ูุญุฏู ูุง ุดุฑูู ููุ ูู ุงูููู ููู ุงูุญูุฏ ููู ุนูู ูู ุดูุก ูุฏูุฑ (100 ูุฑุฉ)</span>
                <span class="dhikr-evidence">
                    ูุงู ุฑุณูู ุงููู ๏ทบ:
        "...ูุงูุช ูู ุนุฏู ุนุดุฑ ุฑูุงุจุ ูููุชุจุช ูู ูุงุฆุฉ ุญุณูุฉุ ูููุญูุช ุนูู ูุงุฆุฉ ุณูุฆุฉุ ููุงูุช ูู ุญุฑุฒูุง ูู ุงูุดูุทุงู ูููู ุฐูู ุญุชู ููุณูุ ููู ูุฃุช ุฃุญุฏ ุจุฃูุถู ููุง ุฌุงุก ุจู ุฅูุง ุฃุญุฏ ุนูู ุฃูุซุฑ ูู ุฐูู".
        "ุนุดุฑ ูุฑุงุชุ ูุงู ููู ุฃุนุชู ุฃุฑุจุนุฉ ุฃููุณ ูู ููุฏ ุฅุณูุงุนูู..."
                    <strong>(ุฑูุงู ุงูุจุฎุงุฑู ููุณูู)</strong>
                </span>
            </div>
        
            <!-- 2. (Previously Option 15) - Best Dhikr -->
            <div class="dhikr-option" data-dhikr="ูุง ุฅูู ุฅูุง ุงููู">
                <span class="dhikr-text">ูุง ุฅูู ุฅูุง ุงููู</span>
                <span class="dhikr-evidence">
                    ูุงู ุฑุณูู ุงููู ๏ทบ: "ุฃูุถู ุงูุฐูุฑ: ูุง ุฅูู ุฅูุง ุงููู".
                    <strong>(ุฑูุงู ุงูุชุฑูุฐู ูุญุณูู ุงูุฃูุจุงูู)</strong>
                </span>
            </div>
        
            <!-- 3. (Previously Option 2) - Most Beloved Words -->
            <div class="dhikr-option" data-dhikr="ุณุจุญุงู ุงูููุ ูุงูุญูุฏ ูููุ ููุง ุฅูู ุฅูุง ุงูููุ ูุงููู ุฃูุจุฑ">
                <span class="dhikr-text">ุณุจุญุงู ุงูููุ ูุงูุญูุฏ ูููุ ููุง ุฅูู ุฅูุง ุงูููุ ูุงููู ุฃูุจุฑ</span>
                <span class="dhikr-evidence">
                    ูุงู ุงููุจู ๏ทบ: "ุฃุญุจ ุงูููุงู ุฅูู ุงููู ุฃุฑุจุน: ุณุจุญุงู ุงูููุ ูุงูุญูุฏ ูููุ ููุง ุฅูู ุฅูุง ุงูููุ ูุงููู ุฃูุจุฑุ ูุง ูุถุฑู ุจุฃููู ุจุฏุฃุช". ููุงู ๏ทบ: "...ุฃุญุจ ุฅูู ููุง ุทูุนุช ุนููู ุงูุดูุณ".
                    <strong>(ุฑูุงู ูุณูู)</strong>
                </span>
            </div>
        
            <!-- 4. (Previously Option 5) - Heavy on Scales, Beloved to Ar-Rahman -->
            <div class="dhikr-option" data-dhikr="ุณุจุญุงู ุงููู ูุจุญูุฏูุ ุณุจุญุงู ุงููู ุงูุนุธูู">
                <span class="dhikr-text">ุณุจุญุงู ุงููู ูุจุญูุฏูุ ุณุจุญุงู ุงููู ุงูุนุธูู</span>
                <span class="dhikr-evidence">
                    ูุงู ุงููุจู ๏ทบ: "ูููุชุงู ุฎูููุชุงู ุนูู ุงููุณุงูุ ุซูููุชุงู ูู ุงูููุฒุงูุ ุญุจูุจุชุงู ุฅูู ุงูุฑุญูู...".
                    <strong>(ุฑูุงู ุงูุจุฎุงุฑู ููุณูู)</strong>
                </span>
            </div>
        
            <!-- 5. (Previously Option 10) - Outweighs Prolonged Dhikr -->
            <div class="dhikr-option" data-dhikr="ุณุจุญุงู ุงููู ูุจุญูุฏู ุนุฏุฏ ุฎููู ูุฑุถุง ููุณู ูุฒูุฉ ุนุฑุดู ููุฏุงุฏ ูููุงุชู">
                <span class="dhikr-text"> (3 ูุฑุงุช) ุณุจุญุงู ุงููู ูุจุญูุฏู ุนุฏุฏ ุฎููู ูุฑุถุง ููุณู ูุฒูุฉ ุนุฑุดู ููุฏุงุฏ ูููุงุชู</span>
                <span class="dhikr-evidence">
                     ุนู ุฌููุฑูุฉ ุฑุถู ุงููู ุนููุง ุฃู ุงููุจู ๏ทบ ูุงู ููุง: "ููุฏ ููุชู ุจุนุฏู ุฃุฑุจุน ูููุงุชุ ุซูุงุซ ูุฑุงุชุ ูู ูุฒูุช ุจูุง ููุชู ููุฐ ุงูููู ููุฒูุชูู...".
                    <strong>(ุฑูุงู ูุณูู)</strong>
                </span>
            </div>
        
            <!-- 6. (Previously Option 8) - More & Better than Day/Night Dhikr -->
            <div class="dhikr-option" data-dhikr="ุณุจุญุงู ุงููู ุนุฏุฏ ูุง ุฎููุ ุณุจุญุงู ุงููู ููุก ูุง ุฎููุ ุณุจุญุงู ุงููู ุนุฏุฏ ูุง ูู ุงูุฃุฑุถ ูุงูุณูุงุกุ ุณุจุญุงู ุงููู ููุก ูุง ูู ุงูุฃุฑุถ ูุงูุณูุงุกุ ุณุจุญุงู ุงููู ุนุฏุฏ ูุง ุฃุญุตู ูุชุงุจูุ ุณุจุญุงู ุงููู ููุก ูุง ุฃุญุตู ูุชุงุจูุ ุณุจุญุงู ุงููู ุนุฏุฏ ูู ุดูุกุ ุณุจุญุงู ุงููู ููุก ูู ุดูุกุ ุงูุญูุฏ ููู ุนุฏุฏ ูุง ุฎููุ ุงูุญูุฏ ููู ููุก ูุง ุฎููุ ุงูุญูุฏ ููู ุนุฏุฏ ูุง ูู ุงูุฃุฑุถ ูุงูุณูุงุกุ ุงูุญูุฏ ููู ููุก ูุง ูู ุงูุฃุฑุถ ูุงูุณูุงุกุ ุงูุญูุฏ ููู ุนุฏุฏ ูุง ุฃุญุตู ูุชุงุจูุ ุงูุญูุฏ ููู ููุก ูุง ุฃุญุตู ูุชุงุจูุ ุงูุญูุฏ ููู ุนุฏุฏ ูู ุดูุกุ ุงูุญูุฏ ููู ููุก ูู ุดูุก">
                <span class="dhikr-text">ุณุจุญุงู ุงููู ุนุฏุฏ ูุง ุฎููุ ุณุจุญุงู ุงููู ููุก ูุง ุฎููุ ุณุจุญุงู ุงููู ุนุฏุฏ ูุง ูู ุงูุฃุฑุถ ูุงูุณูุงุกุ ุณุจุญุงู ุงููู ููุก ูุง ูู ุงูุฃุฑุถ ูุงูุณูุงุกุ ุณุจุญุงู ุงููู ุนุฏุฏ ูุง ุฃุญุตู ูุชุงุจูุ ุณุจุญุงู ุงููู ููุก ูุง ุฃุญุตู ูุชุงุจูุ ุณุจุญุงู ุงููู ุนุฏุฏ ูู ุดูุกุ ุณุจุญุงู ุงููู ููุก ูู ุดูุกุ ุงูุญูุฏ ููู ุนุฏุฏ ูุง ุฎููุ ุงูุญูุฏ ููู ููุก ูุง ุฎููุ ุงูุญูุฏ ููู ุนุฏุฏ ูุง ูู ุงูุฃุฑุถ ูุงูุณูุงุกุ ุงูุญูุฏ ููู ููุก ูุง ูู ุงูุฃุฑุถ ูุงูุณูุงุกุ ุงูุญูุฏ ููู ุนุฏุฏ ูุง ุฃุญุตู ูุชุงุจูุ ุงูุญูุฏ ููู ููุก ูุง ุฃุญุตู ูุชุงุจูุ ุงูุญูุฏ ููู ุนุฏุฏ ูู ุดูุกุ ุงูุญูุฏ ููู ููุก ูู ุดูุก</span>
                <span class="dhikr-evidence">
                    ูุงู ุฑุณูู ุงููู ๏ทบ ูุฃุจู ุฃูุงูุฉ: "ุฃูุง ุฃุฎุจุฑู ุจุฃูุซุฑ ูุฃูุถู ูู ุฐูุฑู ุจุงูููู ูุงูููุงุฑุ..." .
                    <strong>(ุตุญุญู ุงูุฃูุจุงูู ูู ุตุญูุญ ุงูุชุฑุบูุจ: 1575)</strong>
                </span>
            </div>
        
            <!-- 7. (Previously Option 6) - Treasure from Jannah -->
            <div class="dhikr-option" data-dhikr="ูุง ุญูู ููุง ููุฉ ุฅูุง ุจุงููู">
                <span class="dhikr-text">ูุง ุญูู ููุง ููุฉ ุฅูุง ุจุงููู</span>
                <span class="dhikr-evidence">
                    ูุงู ๏ทบ ูุฃุจู ููุณู ุงูุฃุดุนุฑู: "ุฃูุง ุฃุฏูู ุนูู ููุฒ ูู ูููุฒ ุงูุฌูุฉุ"...".
                    <strong>(ุฑูุงู ุงูุจุฎุงุฑู ููุณูู)</strong>
                </span>
            </div>
        
            <!-- 8. (Previously Option 4) - Salawat: 10 Blessings from Allah -->
            <div class="dhikr-option" data-dhikr="ุงูููู ุตู ุนูู ูุญูุฏ ูุนูู ุขู ูุญูุฏ">
                <span class="dhikr-text">ุงูููู ุตู ุนูู ูุญูุฏ ูุนูู ุขู ูุญูุฏ</span>
                <span class="dhikr-evidence">
                    ูุงู ุฑุณูู ุงููู ๏ทบ: "ูู ุตูู ุนููู ุตูุงุฉุ ุตูู ุงููู ุนููู ุจูุง ุนุดุฑูุง".
                    <strong>(ุฑูุงู ูุณูู)</strong>. ููุงู ๏ทบ: "ุฅู ุฃููู ุงููุงุณ ุจู ููู ุงูููุงูุฉ ุฃูุซุฑูู ุนููู ุตูุงุฉ". <strong>(ุญุฏูุซ ุญุณู)</strong>
                </span>
            </div>
        
        
            <!-- 10. (Previously Option 14) - Plants a Palm Tree in Jannah -->
            <div class="dhikr-option" data-dhikr="ุณุจุญุงู ุงููู ูุจุญูุฏู"> <!-- Simplified data-dhikr to match text -->
                <span class="dhikr-text">ุณุจุญุงู ุงููู ูุจุญูุฏู</span>
                <span class="dhikr-evidence">
                    ูุงู ุงููุจู ๏ทบ: "... ุบุฑุณุช ูู ูุฎูุฉ ูู ุงูุฌูุฉ".
                    <strong>(ุฑูุงู ุงูุชุฑูุฐู ูุตุญุญู ุงูุฃูุจุงูู)</strong>
                </span>
            </div>
        
             <!-- 11. (Previously Option 9) - Allah Obliges Himself to Please the Sayer -->
            <div class="dhikr-option" data-dhikr="ุฑุถูุช ุจุงููู ุฑุจูุงุ ูุจุงูุฅุณูุงู ุฏูููุงุ ูุจูุญูุฏู ๏ทบ ูุจููุง">
                <span class="dhikr-text">(3 ูุฑุงุช) ุฑุถูุช ุจุงููู ุฑุจูุงุ ูุจุงูุฅุณูุงู ุฏูููุงุ ูุจูุญูุฏู ๏ทบ ูุจููุง</span>
                <span class="dhikr-evidence">
                    ูุงู ุฑุณูู ุงููู ๏ทบ: "ูุง ูู ุนุจุฏ ูุณูู ูููู ุญูู ูุตุจุญ ูุญูู ููุณู ุซูุงุซ ูุฑุงุช: ุฑุถูุช ุจุงููู ุฑุจูุงุ ูุจุงูุฅุณูุงู ุฏูููุงุ ูุจูุญูุฏ ุตูู ุงููู ุนููู ูุณูู ูุจููุงุ ุฅูุง ูุงู ุญููุง ุนูู ุงููู ุฃู ูุฑุถูู ููู ุงูููุงูุฉ".
                    <strong>(ุฑูุงู ุฃุญูุฏ ูุญุณูู ุงูุฃูุจุงูู ูู ุตุญูุญ ุงูุชุฑุบูุจ)</strong> <!-- Updated reference slightly for accuracy -->
                </span>
            </div>
        
            <!-- 12. (Previously Option 13) - Removes Grief and Sadness -->
            <div class="dhikr-option" data-dhikr="ุงูููู ุฅูู ุนุจุฏูุ ุงุจู ุนุจุฏูุ ุงุจู ุฃูุชูุ ูุงุตูุชู ุจูุฏูุ ูุงุถู ูู ุญูููุ ุนุฏูู ูู ูุถุงุคูุ ุฃุณุฃูู ุจูู ุงุณู ูู ูู ุณููุช ุจู ููุณูุ ุฃู ุนููุชู ุฃุญุฏูุง ูู ุฎูููุ ุฃู ุฃูุฒูุชู ูู ูุชุงุจูุ ุฃู ุงุณุชุฃุซุฑุช ุจู ูู ุนูู ุงูุบูุจ ุนูุฏูุ ุฃู ุชุฌุนู ุงููุฑุขู ุฑุจูุน ููุจูุ ูููุฑ ุตุฏุฑูุ ูุฌูุงุก ุญุฒููุ ูุฐูุงุจ ููู"> <!-- Added full dua for completeness in data-dhikr -->
                <span class="dhikr-text">ุงูููู ุฅูู ุนุจุฏูุ ุงุจู ุนุจุฏูุ ุงุจู ุฃูุชูุ ูุงุตูุชู ุจูุฏูุ ูุงุถู ูู ุญูููุ ุนุฏูู ูู ูุถุงุคูุ ุฃุณุฃูู ุจูู ุงุณู ูู ูู ุณููุช ุจู ููุณูุ ุฃู ุนููุชู ุฃุญุฏูุง ูู ุฎูููุ ุฃู ุฃูุฒูุชู ูู ูุชุงุจูุ ุฃู ุงุณุชุฃุซุฑุช ุจู ูู ุนูู ุงูุบูุจ ุนูุฏูุ ุฃู ุชุฌุนู ุงููุฑุขู ุฑุจูุน ููุจูุ ูููุฑ ุตุฏุฑูุ ูุฌูุงุก ุญุฒููุ ูุฐูุงุจ ููู (ุฏุนุงุก ุงููู ูุงูุญุฒู)</span> <!-- Shortened display text -->
                <span class="dhikr-evidence">
                    ูุงู ุงููุจู ๏ทบ: "ูุง ุฃุตุงุจ ุฃุญุฏุงู ูุท ูู ููุง ุญุฒู ููุงู: ... ุฅูุง ุฃุฐูุจ ุงููู ููู ูุญุฒููุ ูุฃุจุฏูู ููุงูู ูุฑุฌูุง".
                    <strong>(ุฑูุงู ุฃุญูุฏ ูุตุญุญู ุงูุฃูุจุงูู)</strong>
                </span>
            </div>
        
            <!-- 13. (Previously Option 3) - Istighfar: Prophet's practice, brings relief/provision -->
            <div class="dhikr-option" data-dhikr="ุฃุณุชุบูุฑ ุงููู">
                <span class="dhikr-text">ุฃุณุชุบูุฑ ุงููู</span>
                <span class="dhikr-evidence">
                    ูุงู ุงููุจู ๏ทบ: "ูุงููู ุฅูู ูุฃุณุชุบูุฑ ุงููู ูุฃุชูุจ ุฅููู ูู ุงูููู ุฃูุซุฑ ูู ุณุจุนูู ูุฑุฉ".
                    <strong>(ุฑูุงู ุงูุจุฎุงุฑู)</strong>.
                    ููุงู ๏ทบ: "ูู ูุฒู ุงูุงุณุชุบูุงุฑ ุฌุนู ุงููู ูู ูู ูู ูู ูุฑุฌูุงุ ููู ูู ุถูู ูุฎุฑุฌูุงุ ูุฑุฒูู ูู ุญูุซ ูุง ูุญุชุณุจ".
                    <strong>(ุฑูุงู ุฃุจู ุฏุงูุฏ ูุงุจู ูุงุฌู)</strong>
                </span>
            </div>
        
            <!-- 14. (Previously Option 12) - Dua for Distress (Karb) -->
            <div class="dhikr-option" data-dhikr="ูุง ุฅูู ุฅูุง ุงููู ุงูุนุธูู ุงูุญูููุ ูุง ุฅูู ุฅูุง ุงููู ุฑุจ ุงูุนุฑุด ุงูุนุธููุ ูุง ุฅูู ุฅูุง ุงููู ุฑุจ ุงูุณูุงูุงุช ูุฑุจ ุงูุฃุฑุถ ูุฑุจ ุงูุนุฑุด ุงููุฑูู">
                <span class="dhikr-text">ูุง ุฅูู ุฅูุง ุงููู ุงูุนุธูู ุงูุญูููุ ูุง ุฅูู ุฅูุง ุงููู ุฑุจ ุงูุนุฑุด ุงูุนุธููุ ูุง ุฅูู ุฅูุง ุงููู ุฑุจ ุงูุณูุงูุงุช  ูุฑุจ ุงูุฃุฑุถ ูุฑุจ ุงูุนุฑุด ุงููุฑูู (ุฏุนุงุก ุงููุฑุจ)</span>
                <span class="dhikr-evidence">
                    ุฃู ุฑุณูู ุงููู ๏ทบ ูุงู ูููู ุนูุฏ ุงููุฑุจ: "...".
                    <strong>(ุฑูุงู ุงูุจุฎุงุฑู ููุณูู)</strong>
                </span>
            </div>
        
            <!-- 15. (Previously Option 11) - Dua for Distress (Makroob) -->
            <div class="dhikr-option" data-dhikr="ุงูููู ุฑุญูุชู ุฃุฑุฌู ููุง ุชูููู ุฅูู ููุณู ุทุฑูุฉ ุนููุ ูุฃุตูุญ ูู ุดุฃูู ูููุ ูุง ุฅูู ุฅูุง ุฃูุช">
                <span class="dhikr-text">ุงูููู ุฑุญูุชู ุฃุฑุฌู ููุง ุชูููู ุฅูู ููุณู ุทุฑูุฉ ุนููุ ูุฃุตูุญ ูู ุดุฃูู ูููุ ูุง ุฅูู ุฅูุง ุฃูุช (ุฏุนุงุก ุงููุฑุจ)</span>
                <span class="dhikr-evidence">
                    ูุงู ุฑุณูู ุงููู ๏ทบ: "ุฏุนูุงุช ุงูููุฑูุจ: ...".
                    <strong>(ุฑูุงู ุฃุจู ุฏุงูุฏ ูุญุณูู ุงูุฃูุจุงูู)</strong> <!-- Corrected authenticity -->
                </span>
            </div>
        
             <!-- 16. (Previously Option 7) - Statement of Trust (Tawakkul) -->
            <div class="dhikr-option" data-dhikr="ุญุณุจูุง ุงููู ููุนู ุงููููู">
                <span class="dhikr-text">ุญุณุจูุง ุงููู ููุนู ุงููููู</span>
                <span class="dhikr-evidence">
                    ๏ดฟุงูููุฐูููู ููุงูู ูููููู ุงููููุงุณู ุฅูููู ุงููููุงุณู ููุฏู ุฌูููุนููุง ูููููู ููุงุฎูุดููููููู ููุฒูุงุฏููููู ุฅููููุงููุง ููููุงูููุง ุญูุณูุจูููุง ุงูููููู ููููุนููู ุงููููููููู * ููุงูููููุจููุง ุจูููุนูููุฉู ููููู ุงูููููู ููููุถููู ููููู ููููุณูุณููููู ุณููุกู ููุงุชููุจูุนููุง ุฑูุถูููุงูู ุงูููููู...๏ดพ. ููุงููุง ุฅุจุฑุงููู ุนููู ุงูุณูุงู ุญูู ุฃููู ูู ุงููุงุฑ.
                    <strong>(ุขู ุนูุฑุงู: 173-174ุ ูุฑูุงู ุงูุจุฎุงุฑู ุนู ุงุจู ุนุจุงุณ)</strong> <!-- Added context -->
                </span>
            </div>
        
        </div> <!-- End Dhikr Selection -->
    </div> <!-- End Container -->

    <!-- Footer -->
    <footer>ยฉ ุงููุณุจุญุฉ - ุตุฏูุฉ ุฌุงุฑูุฉ ุนู ูุทูุฑูุง ููุงูุฏูู</footer>

    <!-- Share/Install Popup -->
    <div id="share-popup-overlay">
        <div id="share-popup">
            <button id="close-popup-button" aria-label="ุฅุบูุงู">ร</button>
            <h3>ุดุงุฑู ุงูุฎูุฑ ูุงูุดุฑ ุงูุฃุฌุฑ!</h3>
            <p><strong>ูู ุชุนููุ</strong> ููููู ุชุซุจูุช ุชุทุจูู <strong>ุงููุณุจุญุฉ</strong> ุนูู ุฌูุงุฒู ูุงุณุชุฎุฏุงูู ุจุณูููุฉ ุญุชู ุจุฏูู ุงุชุตุงู ุจุงูุฅูุชุฑูุช! ุงุจุญุซ ุนู ุฎูุงุฑ <strong>"ุฅุถุงูุฉ ุฅูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ"</strong> ุฃู "Install App" ูู ูุงุฆูุฉ ุงููุชุตูุญ (โฎ ุฃู ุฒุฑ ุงููุดุงุฑูุฉ).</p>
            <div class="popup-section popup">
                <p>ูุงู ุฑุณูู ุงููู ๏ทบ: <strong>"ุงูุฏุงู ุนูู ุงูุฎูุฑ ููุงุนูู"</strong> (ุฑูุงู ูุณูู). ุณุงูู ูู ูุดุฑ ูุฐุง ุงูุชุทุจูู ููููู ูู ุฃุฌุฑ ูู ูู ูุณุชุฎุฏูู ุจุณุจุจูุ ูุชููู ุตุฏูุฉ ุฌุงุฑูุฉ ูู ุจุฅุฐู ุงููู.</p>
                <p>ุงุถุบุท ููุดุงุฑูุฉ ุงูุฑุงุจุท ูุน ุฑุณุงูุฉ ุฏุนููุฉ:</p>
                <div class="share-buttons">
                    <a href="#" id="whatsapp-share-popup" aria-label="ูุดุงุฑูุฉ ุนุจุฑ ูุงุชุณุงุจ"><img src="icons/whatsapp-icon.png" alt="WhatsApp"></a>
                    <a href="#" id="telegram-share-popup" aria-label="ูุดุงุฑูุฉ ุนุจุฑ ุชูููุฌุฑุงู"><img src="icons/telegram-icon.png" alt="Telegram"></a>
                    <a href="#" id="copy-link-popup" aria-label="ูุณุฎ ุงูุฑุงุจุท ูุงูุฑุณุงูุฉ"><img src="icons/copy-link-icon.png" alt="ูุณุฎ ุงูุฑุงุจุท"></a>
                </div>
                 <span id="copy-status-popup"></span>
            </div>
        </div>
    </div>

    <script>
        // --- Global Variables & Constants ---
        let dhikrScores = {}; // Stores { [dhikrKey]: { current: number } }
        let selectedDhikrKey = null; // Key of the currently selected dhikr (from sessionStorage)
        let selectedDhikrElement = null; // Reference to the selected DOM element
        let highestEverCount = 0; // Stores the overall highest count achieved (from localStorage)

        // DOM Elements
        const hitsElement = document.querySelector("#counter-display .hits");
        const topScoreElement = document.querySelector(".top-score");
        const selectedDhikrDisplay = document.getElementById("selected-dhikr");
        const resetButton = document.getElementById("reset-button");
        const counterArea = document.getElementById("counter-area");
        const dhikrOptions = document.querySelectorAll(".dhikr-option");
        const dhikrSelectionArea = document.getElementById("dhikr-selection");
        const scrollDownArrow = document.getElementById("scroll-down-arrow");
        const sharePopupOverlay = document.getElementById('share-popup-overlay');
        const sharePopup = document.getElementById('share-popup');
        const closePopupButton = document.getElementById('close-popup-button');
        const whatsappSharePopup = document.getElementById('whatsapp-share-popup');
        const telegramSharePopup = document.getElementById('telegram-share-popup');
        const copyLinkPopup = document.getElementById('copy-link-popup');
        const copyStatusPopup = document.getElementById('copy-status-popup');
        const whatsappShareTop = document.getElementById('whatsapp-share-top');
        const telegramShareTop = document.getElementById('telegram-share-top');
        const copyLinkTop = document.getElementById('copy-link-top');
        const copyStatusTop = document.getElementById('copy-status-top');
        const enableRemindersButton = document.getElementById('enable-reminders-button');
        const reminderStatusElement = document.getElementById('reminder-status');

        // Storage Keys
        const STORAGE_KEY_SCORES = 'AlMisbahahScores_v2'; // Key for current counts object (localStorage) - Increment version if structure changes
        const STORAGE_KEY_HIGHEST_COUNT = 'AlMisbahahHighestCount_v1'; // Key for the overall highest count (localStorage)
        const STORAGE_KEY_LAST_DHIKR = 'AlMisbahahLastDhikr_Session'; // Key for last selected Dhikr (sessionStorage)
        const STORAGE_KEY_POPUP_SHOWN = 'AlMisbahahPopupShown_Session'; // Key for popup state (sessionStorage)

        // Shared Data for Sharing
        const shareUrl = "https://yelsabbagh.github.io/AlMisbahah/";
        const shareBaseText = `๐ *ุงููุณุจุญุฉ ุงูุฅููุชุฑูููุฉ* ๐\n\nุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชูุ\n\nูุณุฑููุง ุฃู ููุฏู ููู ุชุทุจูู *ุงููุณุจุญุฉ ุงูุฅููุชุฑูููุฉ* ุงูุจุณูุท ูุงููููุฏ ููุณุงุนุฏุชูู ุนูู ุชุชุจูุน ุงูุฃุฐูุงุฑ ุงูููููุฉ.\n\nโจ *ูููุฒุงุช ุงูุชุทุจูู:*\n- ุณูู ุงูุงุณุชุฎุฏุงู.\n- ูุญูุธ ุฃุนูู ุฑุตูุฏ ุฅุฌูุงูู ููุนุฏ.\n- ูููู ุชุซุจูุชู ุนูู ุฌูุงุฒู ("ุฅุถุงูุฉ ุฅูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ") ูุงุณุชุฎุฏุงูู *ุจุฏูู ุฅูุชุฑูุช*!\n\nูุงู ุฑุณูู ุงููู ๏ทบ: "*ุงูุฏููุงููู ุนูู ุงูุฎูุฑ ููุงุนูู*" (ุฑูุงู ูุณูู).\n\n๐ ูุง ุชูุณ ูุดุงุฑูุฉ ุงูุชุทุจูู ูุน ูู ุชุญุจุ ูุชูุงู ุฃุฌุฑ ุงูุฏูุงูุฉ ุนูู ุงูุฎูุฑ ูุชููู ูู ุตุฏูุฉ ุฌุงุฑูุฉ ุจุฅุฐู ุงููู.\n\n๐ ุฑุงุจุท ุงูุชุทุจูู:\n${shareUrl}`;
        const encodedShareText = encodeURIComponent(shareBaseText);


        // --- Storage Handling ---
        function loadScores() {
            // Load current counts for each dhikr from localStorage
            const savedScores = localStorage.getItem(STORAGE_KEY_SCORES);
            if (savedScores) {
                try {
                    dhikrScores = JSON.parse(savedScores);
                    // Ensure loaded scores have the expected structure (just 'current')
                    Object.keys(dhikrScores).forEach(key => {
                        if (typeof dhikrScores[key] !== 'object' || dhikrScores[key] === null || typeof dhikrScores[key].current !== 'number') {
                             console.warn(`Invalid score structure for ${key}, resetting.`);
                             dhikrScores[key] = { current: 0 };
                        }
                        // Remove any legacy 'top' properties if they exist
                        if (dhikrScores[key].hasOwnProperty('top')) {
                            delete dhikrScores[key].top;
                        }
                    });
                } catch (e) {
                    console.error("Failed to parse dhikrScores:", e);
                    dhikrScores = {};
                }
            } else {
                dhikrScores = {};
            }

            // Load the overall highest count ever achieved from localStorage
            highestEverCount = parseInt(localStorage.getItem(STORAGE_KEY_HIGHEST_COUNT) || '0', 10);
            if (isNaN(highestEverCount)) highestEverCount = 0; // Ensure it's a number

            // Load last selected Dhikr from sessionStorage (resets per session)
            selectedDhikrKey = sessionStorage.getItem(STORAGE_KEY_LAST_DHIKR);
         }

        function saveScores() {
             try {
                // Save current counts object to localStorage
                localStorage.setItem(STORAGE_KEY_SCORES, JSON.stringify(dhikrScores));
                // Save the overall highest count to localStorage
                localStorage.setItem(STORAGE_KEY_HIGHEST_COUNT, highestEverCount.toString());
                // Save last selected Dhikr to sessionStorage
                sessionStorage.setItem(STORAGE_KEY_LAST_DHIKR, selectedDhikrKey || '');
             } catch (e) { console.error("Failed to save scores:", e); }
        }

        // --- Rendering ---
        function updateDisplay() {
            // Get current count for the selected dhikr, default to 0 if none selected
            const currentScore = selectedDhikrKey && dhikrScores[selectedDhikrKey] ? dhikrScores[selectedDhikrKey].current : 0;

            if (hitsElement) hitsElement.textContent = currentScore;
            if (topScoreElement) topScoreElement.textContent = `ุฃุนูู ุฑุตูุฏ ุฅุฌูุงูู: ${highestEverCount}`; // Display the overall highest count
            if (selectedDhikrDisplay) selectedDhikrDisplay.textContent = selectedDhikrKey || 'ุงุฎุชุฑ ุฐูุฑุงู ููุจุฏุก';
            if (resetButton) resetButton.style.display = selectedDhikrKey ? '' : 'none';
        }

        // --- Core Logic ---
        function selectDhikr(dhikrKey, dhikrElement) {
             if (typeof(Storage) === "undefined") { console.warn("Local/Session storage not available."); }
            if (selectedDhikrElement) { selectedDhikrElement.classList.remove('selected'); }

            if (selectedDhikrKey === dhikrKey) {
                // Deselect if clicking the same one again
                selectedDhikrKey = null;
                selectedDhikrElement = null;
            } else {
                // Select the new one
                selectedDhikrKey = dhikrKey;
                selectedDhikrElement = dhikrElement;
                selectedDhikrElement.classList.add('selected');
                // Ensure score object exists for this dhikr, initialize if not
                if (!dhikrScores[selectedDhikrKey]) {
                    dhikrScores[selectedDhikrKey] = { current: 0 };
                }
                 window.scrollTo({ top: 0, behavior: 'smooth' });
            }
            // *** NO LONGER RESETTING current count here ***
            saveScores(); // Save selection status (session) and potentially initialized score (local)
            updateDisplay(); // Update the display to show the count for the selected dhikr
        }

        function incrementCount() {
             if (!selectedDhikrKey) return; // Only count if a dhikr is selected
             if (!dhikrScores[selectedDhikrKey]) {
                 dhikrScores[selectedDhikrKey] = { current: 0 }; // Safety init
             }

            // Increment current count for the selected dhikr
            dhikrScores[selectedDhikrKey].current++;

            // Check if this new current count exceeds the overall highest count
            if (dhikrScores[selectedDhikrKey].current > highestEverCount) {
                highestEverCount = dhikrScores[selectedDhikrKey].current;
                 console.log("New highest ever count:", highestEverCount);
            }

            saveScores(); // Save updated current count and potentially new highestEverCount
            updateDisplay();

            // --- VIBRATION ---
            if ('vibrate' in navigator) {
                try { navigator.vibrate(50); } catch (err) { console.warn("Vibration failed:", err); }
            }
            // --- END VIBRATION ---
        }

        function resetCurrentCount() {
            if (!selectedDhikrKey || !dhikrScores[selectedDhikrKey]) return;
            // Only reset the current count for the selected dhikr
            dhikrScores[selectedDhikrKey].current = 0;
            saveScores(); // Save the reset current count
            updateDisplay();
            // Note: Does NOT reset highestEverCount
        }

        function scrollToDhikrSelection() { dhikrSelectionArea.scrollIntoView({ behavior: 'smooth' }); }

        // --- Popup Logic ---
        function showPopup() {
            if (!sharePopupOverlay) return; // Safety check
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            const popupShownSession = sessionStorage.getItem(STORAGE_KEY_POPUP_SHOWN);
            if (!isStandalone && !popupShownSession) {
                sharePopupOverlay.style.display = 'flex';
                sessionStorage.setItem(STORAGE_KEY_POPUP_SHOWN, 'true');
                if(copyStatusPopup) copyStatusPopup.textContent = '';
            } else { console.log('Popup not shown (standalone or shown this session)'); }
        }
        function hidePopup() { if(sharePopupOverlay) sharePopupOverlay.style.display = 'none'; }

        // --- Generic Share Functions ---
        function shareViaWhatsapp() { const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareBaseText)}`; window.open(whatsappUrl, '_blank'); }
        function shareViaTelegram() { const telegramUrl = `https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodedShareText}`; window.open(telegramUrl, '_blank'); }
        function copyShareLink(statusElement) {
            if (!statusElement || !navigator.clipboard) return; // Safety check
             navigator.clipboard.writeText(shareBaseText)
                .then(() => { statusElement.textContent = 'ุชู ุงููุณุฎ!'; setTimeout(() => { statusElement.textContent = ''; }, 2500); })
                .catch(err => { console.error('Failed to copy text: ', err); statusElement.textContent = 'ูุดู ุงููุณุฎ!'; setTimeout(() => { statusElement.textContent = ''; }, 2500); });
        }

        // --- Reminder Functions ---
        async function registerPeriodicSync() {
            console.log('Attempting to register periodic sync...');
            if (!('serviceWorker' in navigator && 'PeriodicSyncManager' in window)) {
                 console.warn('Periodic background sync is not supported.');
                 if (reminderStatusElement) reminderStatusElement.textContent = 'ุงูุชุฐููุฑุงุช ุงูุฏูุฑูุฉ ุบูุฑ ูุฏุนููุฉ ุจูุฐุง ุงููุชุตูุญ.';
                 return false;
            }

            try {
                const notificationPermission = await Notification.requestPermission();
                if (notificationPermission !== 'granted') {
                    console.warn('Notification permission not granted.');
                    if (reminderStatusElement) reminderStatusElement.textContent = 'ูุฑุฌู ุงูุณูุงุญ ุจุงูุฅุดุนุงุฑุงุช ูุชูุนูู ุงูุชุฐููุฑ.';
                    return false;
                }
                console.log('Notification permission granted.');

                const registration = await navigator.serviceWorker.ready;

                const periodicSyncPermissionStatus = await registration.permissions.query({ name: 'periodic-background-sync' });
                console.log('Periodic sync permission state:', periodicSyncPermissionStatus.state);

                if (periodicSyncPermissionStatus.state === 'denied') {
                    console.warn('Periodic sync permission denied.');
                    if (reminderStatusElement) reminderStatusElement.textContent = 'ุชู ุฑูุถ ุฅุฐู ุงููุฒุงููุฉ ุงูุฏูุฑูุฉ. ูุฑุฌู ุชูุนููู ูู ุฅุนุฏุงุฏุงุช ุงููุชุตูุญ.';
                    return false;
                }

                await registration.periodicSync.register('dhikr-reminder', { minInterval: 12 * 60 * 60 * 1000 });
                console.log('Periodic background sync "dhikr-reminder" registered successfully!');
                return true;

            } catch (error) {
                 console.error('Failed during periodic sync registration process:', error);
                 if (reminderStatusElement) reminderStatusElement.textContent = 'ูุดู ุชุณุฌูู ุงูุชุฐููุฑุงุช ุงูุฏูุฑูุฉ.';
                 return false;
            }
        }

        async function checkPeriodicSyncStatus() {
             console.log('Checking periodic sync status...');
             if (enableRemindersButton) enableRemindersButton.style.display = 'none';
             if (reminderStatusElement) reminderStatusElement.textContent = '';

             if (!('serviceWorker' in navigator && 'PeriodicSyncManager' in window)) {
                  console.log('Periodic sync not supported, hiding reminder UI.');
                  if (reminderStatusElement) reminderStatusElement.textContent = 'ุงูุชุฐููุฑุงุช ุงูุฏูุฑูุฉ ุบูุฑ ูุฏุนููุฉ.';
                  return;
             }

             try {
                 const registration = await navigator.serviceWorker.ready;
                 const tags = await registration.periodicSync.getTags();

                 if (tags.includes('dhikr-reminder')) {
                     console.log('Periodic sync "dhikr-reminder" is registered.');
                     if (reminderStatusElement) reminderStatusElement.textContent = 'ุชุฐููุฑุงุช ุงูุฃุฐูุงุฑ ุงูููููุฉ ููุนูุฉ.';
                     if (enableRemindersButton) enableRemindersButton.style.display = 'none';
                 } else {
                     console.log('Periodic sync "dhikr-reminder" is not registered.');
                     const notificationPermissionStatus = await navigator.permissions.query({ name: 'notifications' });
                     console.log('Notification permission state:', notificationPermissionStatus.state);

                     if (notificationPermissionStatus.state === 'denied') {
                         if (reminderStatusElement) reminderStatusElement.textContent = 'ุชู ุญุธุฑ ุงูุฅุดุนุงุฑุงุช. ูุฑุฌู ุงูุณูุงุญ ุจูุง ูุชูุนูู ุงูุชุฐููุฑุงุช.';
                     } else { // Granted or Prompt
                         try {
                             const periodicSyncPermissionStatus = await navigator.permissions.query({ name: 'periodic-background-sync' });
                             console.log('Periodic sync permission state:', periodicSyncPermissionStatus.state);
                             if (periodicSyncPermissionStatus.state === 'denied') {
                                 if (reminderStatusElement) reminderStatusElement.textContent = 'ุชู ุฑูุถ ุฅุฐู ุงููุฒุงููุฉ ุงูุฏูุฑูุฉ. ูุฑุฌู ุชูุนููู ูู ุฅุนุฏุงุฏุงุช ุงููุชุตูุญ.';
                             } else { // granted or prompt
                                 if (enableRemindersButton) enableRemindersButton.style.display = 'block';
                             }
                         } catch (permError) {
                              console.warn("Could not query periodic sync permission, showing button.", permError);
                              if (enableRemindersButton) enableRemindersButton.style.display = 'block';
                         }
                     }
                 }
             } catch (error) {
                 console.error('Failed to check periodic sync status:', error);
                 if (reminderStatusElement) reminderStatusElement.textContent = 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุญูู ูู ุญุงูุฉ ุงูุชุฐููุฑ.';
             }
        }

        // --- Event Listeners ---
        // Add checks to ensure elements exist before adding listeners
        if (dhikrOptions) dhikrOptions.forEach(option => option.addEventListener('click', () => selectDhikr(option.dataset.dhikr, option)));
        if (counterArea) counterArea.addEventListener('click', (event) => { if (!event.target.closest('#reset-button')) incrementCount(); });
        if (resetButton) resetButton.addEventListener('click', (event) => { event.stopPropagation(); resetCurrentCount(); });
        if (scrollDownArrow) scrollDownArrow.addEventListener('click', (event) => { event.stopPropagation(); scrollToDhikrSelection(); });
        document.body.addEventListener('keyup', (event) => {
            const activeElement = document.activeElement;
            const isTyping = activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA' || activeElement.isContentEditable);
            const isResetButtonFocused = activeElement === resetButton && (event.key === 'Enter' || event.key === ' ');
            const allowedKeys = ['Enter', ' ', 'Spacebar', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'];
            if (!isTyping && !isResetButtonFocused && allowedKeys.includes(event.key)) { incrementCount(); if (event.key.startsWith('Arrow')) { event.preventDefault(); } }
        });
        if (closePopupButton) closePopupButton.addEventListener('click', hidePopup);
        if (sharePopupOverlay) sharePopupOverlay.addEventListener('click', (event) => { if (event.target === sharePopupOverlay) { hidePopup(); } });
        if (whatsappSharePopup) whatsappSharePopup.addEventListener('click', (e) => { e.preventDefault(); shareViaWhatsapp(); hidePopup(); });
        if (telegramSharePopup) telegramSharePopup.addEventListener('click', (e) => { e.preventDefault(); shareViaTelegram(); hidePopup(); });
        if (copyLinkPopup) copyLinkPopup.addEventListener('click', (e) => { e.preventDefault(); copyShareLink(copyStatusPopup); setTimeout(hidePopup, 2600); });
        if (whatsappShareTop) whatsappShareTop.addEventListener('click', (e) => { e.preventDefault(); shareViaWhatsapp(); });
        if (telegramShareTop) telegramShareTop.addEventListener('click', (e) => { e.preventDefault(); shareViaTelegram(); });
        if (copyLinkTop) copyLinkTop.addEventListener('click', (e) => { e.preventDefault(); copyShareLink(copyStatusTop); });

        // Reminder Button Listener
        if (enableRemindersButton) {
            enableRemindersButton.addEventListener('click', async () => {
                enableRemindersButton.disabled = true;
                enableRemindersButton.textContent = 'ุฌุงุฑู ุงูุชูุนูู...';
                if (reminderStatusElement) reminderStatusElement.textContent = '';
                const success = await registerPeriodicSync();
                if (success) {
                    enableRemindersButton.style.display = 'none';
                    if (reminderStatusElement) reminderStatusElement.textContent = 'ุชู ุชูุนูู ุชุฐููุฑุงุช ุงูุฃุฐูุงุฑ ุงูููููุฉ ุจูุฌุงุญ!';
                } else {
                     enableRemindersButton.textContent = 'ุชูุนูู ุชุฐููุฑุงุช ุงูุฃุฐูุงุฑ ุงูููููุฉ';
                }
                enableRemindersButton.disabled = false;
            });
        }

        // --- Initialization ---
        loadScores(); // Load permanent scores/highest count and session's last dhikr
        // Apply selection visually if a dhikr was loaded from session storage
        if (selectedDhikrKey) {
            const lastSelectedElement = document.querySelector(`.dhikr-option[data-dhikr="${selectedDhikrKey}"]`);
            if (lastSelectedElement) {
                selectedDhikrElement = lastSelectedElement;
                selectedDhikrElement.classList.add('selected');
                // Ensure score object exists even if loaded from session
                if (!dhikrScores[selectedDhikrKey]) {
                    dhikrScores[selectedDhikrKey] = { current: 0 };
                    saveScores(); // Save the initialized score
                }
            } else {
                 console.warn("Last selected Dhikr key from session not found in options.");
                 selectedDhikrKey = null;
                 sessionStorage.removeItem(STORAGE_KEY_LAST_DHIKR); // Clear invalid key from session storage
            }
        }
        updateDisplay(); // Update counters and selected dhikr text

        // --- Load Event: Service Worker Registration & UI Setup ---
        window.addEventListener('load', () => {
            setTimeout(showPopup, 1500); // Show welcome popup

             if ('serviceWorker' in navigator) {
                 navigator.serviceWorker.register('/sw.js')
                   .then(registration => {
                       console.log('SW registration successful, scope is:', registration.scope);
                       checkPeriodicSyncStatus(); // Check reminder status AFTER SW is ready
                    })
                   .catch(error => {
                       console.log('SW registration failed:', error);
                       if(enableRemindersButton) enableRemindersButton.style.display = 'none';
                       if(reminderStatusElement) reminderStatusElement.textContent = '';
                   });
             } else {
                 console.log('Service workers not supported, hiding reminder UI.');
                 if(enableRemindersButton) enableRemindersButton.style.display = 'none';
                 if(reminderStatusElement) reminderStatusElement.textContent = '';
             }
        });

    </script>

</body>
</html>
